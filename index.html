<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fire Door Survey Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
    :root{--primary:#003087;--accent:#0066cc;--success:#28a745;--danger:#dc3545;--gray:#f8f9fa;--dark:#1a1a1a}
    body{font-family:'Segoe UI',Arial,sans-serif;margin:0;background:var(--gray);color:#333;line-height:1.4}
    h1{background:var(--primary);color:white;padding:18px;margin:0;text-align:center;font-size:1.9em;font-weight:600}

    .cover{max-width:1000px;margin:15px auto;background:white;border-radius:12px;overflow:hidden;
           box-shadow:0 6px 25px rgba(0,0,0,0.15);position:relative;cursor:pointer;text-align:center}
    .cover img{width:100%;max-height:400px;object-fit:cover;display:block}
    .cover-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.6);color:white;
                   font-size:1.8em;display:flex;align-items:center;justify-content:center}
    .cover input{position:absolute;inset:0;opacity:0;cursor:pointer}
    #coverPlaceholder{padding:100px;background:#e3f2fd;color:#1565c0;font-size:1.6em}

    .cover-info{padding:20px;background:white;color:#333;font-size:1.4em;font-weight:600;display:none}
    .cover-info .project{font-size:1.8em;color:var(--primary);margin-bottom:8px}
    .cover-info .surveyor{font-size:1.3em;color:#555;margin-top:12px}

    /* Rest of your CSS stays exactly the same… */
    /* (I kept it short here — the full CSS from the last working version goes here) */
    @media print{
        .cover-info{display:block !important}
        /* rest of print CSS unchanged */
    }
</style>
</head>
<body>

<h1>Fire Door Survey Report</h1>

<div class="cover" id="coverArea">
    <div class="cover-overlay">Click to add building photo</div>
    <input type="file" id="buildingPhotoInput" accept="image/*">
    <img id="buildingPhoto" src="" style="display:none">
    <div id="coverPlaceholder">Building / Facility Photo<br><small>Click anywhere to upload</small></div>

    <div class="cover-info">
        <div class="project" id="printProjectName">Project Name</div>
        <div>Fire Door Inspection Report</div>
        <div class="surveyor">Surveyor: <span id="printSurveyorName">Name</span></div>
    </div>
</div>

<!-- Rest of your HTML (controls, container, summary page) unchanged -->

<script>
// ←←← THIS IS THE ONLY CHANGE YOU NEED ←←←
const coverImg = document.getElementById('buildingPhoto');
const coverOverlay = document.querySelector('.cover-overlay');
const coverPlaceholder = document.getElementById('coverPlaceholder');

// Force repaint when a new photo is chosen so it shows in print/PDF
document.getElementById('buildingPhotoInput').onchange = async e => {
    const file = e.target.files[0];
    if (!file) return;
    const dataUrl = await fileToBase64(file);
    await dataUrl; // wait for conversion
    coverImg.src = dataUrl;
    coverImg.style.display = 'block';
    coverOverlay.style.display = 'none';
    coverPlaceholder.style.display = 'none';
    // ←←← NEW: Force Safari to re-render the image for print/export
    coverImg.onload = () => {
        coverImg.style.opacity = '0.999'; // tiny hack to trigger repaint
        setTimeout(() => coverImg.style.opacity = '1', 50);
    };
};

// Keep everything else exactly the same (createDoor, save/load, etc.)
// ←←← END OF CHANGE ←←←

function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

/* … all the rest of your script (App object, createDoor, save/load, etc.) stays 100% identical … */
</script>
</body>
</html>